---
title: "Fit own data"
author: "Xiaoyan Yue"
date: "1/12/2017"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache= TRUE, autodep = TRUE)

library(rethinking)
library(reshape2)
library(ggplot2)
library(brms)
library(rstan)


rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
```


```{r, fig.width=18, fig.height=8}
d_own <- read.csv("/Users/xyyue/Documents/Phosphrous_project/Data_Jan6th/RSA_ILs")

d_own
#change the name of P-/P+
d_own$type2 <- ifelse(d_own$type=="P-","P_limited","P_sufficient")
d_own$sample <- sub("-","_",d_own$sample,fixed = TRUE)

summary(d_own)
str(d_own)
#plot the raw data
#plot for primary root length
source("/Users/xyyue/function.R")
p <- ggplot(data=d_own,aes(x=type2,y=length,color=type2)) 
p <- p + geom_jitter()
p <- p + stat_summary(fun.y="mean",geom="bar",alpha=0.5)
p <- p + stat_summary(fun.data="calc.sem",geom="errorbar",position="dodge") 
p <- p + facet_grid(.~sample)
p <- p + labs(title="Primary Root Length")
p
```

```{r}
#plot for number of later root
p <- ggplot(data=d_own,aes(x=type2,y=n_child,color=type2)) 
p <- p + geom_jitter()
p <- p + stat_summary(fun.y="mean",geom="bar",alpha=0.5)
p <- p + stat_summary(fun.data="calc.sem",geom="errorbar",position="dodge") 
p <- p + facet_grid(.~sample)
p <- p + labs(title="Number of Later Root")
p


#fit the model for primary root length
m.brms <- brm(length ~ 0 + sample * type2 + (1|image),#the average of random effect is 0, so the estimate is the standard deviation
            data = d_own,
            prior = c(
              set_prior("normal(0,10)",class="b"), # sets prior for all b coefficients
              set_prior("normal(0,20)",class="b", coef = "type2P_sufficient"), #set prior for "typeP_sufficient"
              set_prior("cauchy(0,1)", class = "sigma"), #half cauchy prior for sigma
              set_prior("normal(0,1)", class = "sd", group = "image") #prior for plate
            ))

summary(m.brms)


#family specified parameter: it is the overall standard deviation for gussian distribution of the model

#test the effect of type of plate:
(Primary_root_length <- hypothesis(m.brms,"type2P_sufficient=0"))

#test the effect of type of plate for M82 only
(Primary_root_lengthM82 <- hypothesis(m.brms,"sampleM82:type2P_sufficient=0"))

#fit the model for number of later root
m.brms2 <- brm(n_child ~ 0 + sample * type2 + (1|image),
            data = d_own,
            prior = c(
              set_prior("normal(0,10)",class="b"), # sets prior for all b coefficients
              set_prior("normal(0,20)",class="b", coef = "type2P_sufficient"), #set prior for "typeP_sufficient"
              set_prior("cauchy(0,1)", class = "sigma"), #half cauchy prior for sigma
              set_prior("normal(0,1)", class = "sd", group = "image") #prior for plate
            ))

summary(m.brms2)
#test the effect of type of plate:
(Primary_root_length <- hypothesis(m.brms2,"type2P_sufficient=0"))

#test the effect of type of plate for M82 only
(Primary_root_lengthM82 <- hypothesis(m.brms2,"sampleM82:type2P_sufficient=0"))
```

